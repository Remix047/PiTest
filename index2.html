<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Donación de 1 Pi</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f4f4f4;
        }
        #donateButton {
            padding: 10px 20px;
            font-size: 16px;
            color: white;
            background-color: #008CBA;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        #donateButton:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
    </style>
    <script src="https://sdk.minepi.com/pi-sdk.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const donateButton = document.getElementById('donateButton');
            donateButton.disabled = true;

            // Inicializar el SDK de Pi Network en modo sandbox
            Pi.init({ version: "2.0", sandbox: true });

            // Autenticar al usuario
            const scopes = ['payments'];
            function onIncompletePaymentFound(payment) {
                console.log('Pago incompleto encontrado:', payment);
            }

            Pi.authenticate(scopes, onIncompletePaymentFound).then(function(auth) {
                console.log('Usuario autenticado:', auth);
                donateButton.disabled = false; // Habilitar el botón después de la autenticación
            }).catch(function(error) {
                console.error('Error en la autenticación:', error);
            });

            // Manejar el clic en el botón de donación
            donateButton.addEventListener('click', function() {
                const paymentData = {
                    amount: 1,
                    memo: 'Donación de prueba',
                    metadata: { purpose: 'donation' },
                };

                const paymentCallbacks = {
                    onReadyForServerApproval: function(paymentId) {
                        console.log('Listo para aprobación del servidor:', paymentId);
                        // Aquí puedes enviar el paymentId a tu servidor para su aprobación
                    },
                    onReadyForServerCompletion: function(paymentId, txid) {
                        console.log('Listo para completar en el servidor:', paymentId, txid);
                        // Aquí puedes completar la transacción en tu servidor
                    },
                    onCancel: function(paymentId) {
                        console.log('Pago cancelado:', paymentId);
                    },
                    onError: function(error, payment) {
                        console.error('Error en el pago:', error, payment);
                    }
                };

                Pi.createPayment(paymentData, paymentCallbacks).then(function(payment) {
                    console.log('Pago creado:', payment);
                }).catch(function(error) {
                    console.error('Error al crear el pago:', error);
                });
            });
        });
    </script>
</head>
<body>
    <button id="donateButton">Donar 1 Pi</button>
</body>
</html>
