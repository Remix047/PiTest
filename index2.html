<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Donación de 1 Pi</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
      text-align: center;
      padding-top: 80px;
      margin: 0;
    }
    h1 {
      color: #333;
    }
    button {
      padding: 12px 25px;
      font-size: 16px;
      border: none;
      border-radius: 5px;
      margin: 10px;
      cursor: pointer;
    }
    #authButton {
      background-color: #28a745;
      color: white;
    }
    #donateButton {
      background-color: #007bff;
      color: white;
    }
    #donateButton:disabled {
      background-color: #cccccc;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
  <h1>Donación de 1 Pi</h1>
  <button id="authButton">Autenticarse</button>
  <button id="donateButton" disabled>Donar 1 Pi</button>

  <!-- Incluir el SDK de Pi Network para interfaz -->
  <script src="https://sdk.minepi.com/pi-sdk.js"></script>
  <script>
    // Inicializamos el SDK indicando la versión
    Pi.init({ version: "2.0" sandbox: true });

    const authButton = document.getElementById('authButton');
    const donateButton = document.getElementById('donateButton');

    // Callback para pagos incompletos, según la documentación (puedes extenderlo si lo necesitas)
    function onIncompletePaymentFound(payment) {
      console.log("Pago incompleto encontrado:", payment);
    }

    // Autenticación del usuario
    authButton.addEventListener('click', () => {
      const scopes = ['payments']; // Permite solicitar pagos al usuario
      Pi.authenticate(scopes, onIncompletePaymentFound)
        .then((auth) => {
          console.log("Autenticación exitosa:", auth);
          alert("¡Autenticación exitosa!");
          // Habilitamos el botón de donar solo tras una autenticación exitosa
          donateButton.disabled = false;
        })
        .catch((error) => {
          console.error("Error en autenticación:", error);
          alert("Error en autenticación: " + error.message);
        });
    });

    // Solicitar el pago (donar 1 Pi)
    donateButton.addEventListener('click', () => {
      Pi.createPayment({
        amount: 1, // Monto en Pi a donar
        memo: "Donación de 1 Pi",
        metadata: {} // Puedes incluir datos adicionales aquí
      }, {
        onReadyForServerApproval: function(paymentId) {
          console.log("Listo para aprobación en el servidor. Payment ID:", paymentId);
          // En un entorno real se debe aprobar la transacción en el servidor.
          // Para propósitos de demo simulamos la aprobación y completamos la transacción.
          setTimeout(() => {
            // Simulamos la respuesta del servidor con un txid ficticio
            const txid = "tx_simulada_123456";
            this.onReadyForServerCompletion(paymentId, txid);
          }, 2000);
        },
        onReadyForServerCompletion: function(paymentId, txid) {
          console.log("Pago completado. Payment ID:", paymentId, "Transaction ID:", txid);
          alert("¡Donación completada!");
        },
        onCancel: function(paymentId) {
          console.log("Pago cancelado. Payment ID:", paymentId);
          alert("Pago cancelado.");
        },
        onError: function(error, payment) {
          console.error("Error en pago:", error, payment);
          alert("Error en el pago: " + error.message);
        }
      });
    });
  </script>
</body>
</html>
